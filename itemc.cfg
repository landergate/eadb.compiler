--[[
    ~ Configuration ~
    output_format         :"txt" | "lua"
        * txt follows the idnum2itemdesctable.txt format
        * lua follows the itemInfo.lua format
    output_filename
        * creates the output file with this file name
    server_type            : "eathena" | "rathena_re" | "hercules_re" | "resource"
        * specifies how to translate the item database for a server type
    resource_db_path
        * path to the resource sqlite3 database produce by iteml
    server_db_path
        * path to the server sqlite3 database produce by iteml
--]]

--[[ item format rule defaults ]]
general_default = {
    {
        ["item_id"] = {-1, -1},
        ["format"] = {
            { ["type"] = "flavour" },
            { ["type"] = "script" },
            { ["type"] = "trade",           ["color"] = "FF0000" },
            { ["type"] = "buyingstore",     ["text"] = "^FF00FFMay be sold in buying store.^000000" },
            { ["type"] = "stack",           ["color"] = "777777" },
            { ["type"] = "weight",          ["text"] = "Weight: ",          ["color"] = "777777" },
            { ["type"] = "delay",           ["text"] = "Item Delay: ",      ["color"] = "777777" }
        }
    }
}

weapon_default = {
    {
        -- display range for ranged weapons
        ["item_id"] = {-1, -1},
        ["weapon_type"] = {11, 13, 14, 17, 18, 19, 20, 21, 22},
        ["format"] = {
            { ["type"] = "flavour" },
            { ["type"] = "script" },
            { ["type"] = "trade",           ["color"] = "FF0000" },
            { ["type"] = "refinement",      ["text"] = "^FF0000Impossible to refine this item.^000000" },
            { ["type"] = "bind",            ["text"] = "^FF0000Equipment binds to character on equipped.^000000" },
            { ["type"] = "buyingstore",     ["text"] = "^FF00FFMay be sold in buying store.^000000" },
            { ["type"] = "view",            ["text"] = "Class: ",           ["color"] = "777777" },
            { ["type"] = "attack",          ["text"] = "Attack: ",          ["color"] = "777777" },
            { ["type"] = "magical_attack",  ["text"] = "Magical Attack: ",  ["color"] = "777777" },
            { ["type"] = "range",           ["text"] = "Range: ",           ["color"] = "777777" },
            { ["type"] = "weight",          ["text"] = "Weight: ",          ["color"] = "777777" },
            { ["type"] = "weapon_level",    ["text"] = "Weapon Level: ",    ["color"] = "777777" },
            { ["type"] = "require_level",   ["text"] = "Required Level: ",  ["color"] = "777777" },
            { ["type"] = "job",             ["text"] = "Job: ",             ["color"] = "777777" },
            { ["type"] = "upper",           ["text"] = "Tier: ",            ["color"] = "777777" }
        }
    },{
        ["item_id"] = {-1, -1},
        ["format"] = {
            { ["type"] = "flavour" },
            { ["type"] = "script" },
            { ["type"] = "trade",           ["color"] = "FF0000" },
            { ["type"] = "refinement",      ["text"] = "^FF0000Impossible to refine this item.^000000" },
            { ["type"] = "bind",            ["text"] = "^FF0000Equipment binds to character on equipped.^000000" },
            { ["type"] = "buyingstore",     ["text"] = "^FF00FFMay be sold in buying store.^000000" },
            { ["type"] = "view",            ["text"] = "Class: ",           ["color"] = "777777" },
            { ["type"] = "attack",          ["text"] = "Attack: ",          ["color"] = "777777" },
            { ["type"] = "magical_attack",  ["text"] = "Magical Attack: ",  ["color"] = "777777" },
            { ["type"] = "weight",          ["text"] = "Weight: ",          ["color"] = "777777" },
            { ["type"] = "weapon_level",    ["text"] = "Weapon Level: ",    ["color"] = "777777" },
            { ["type"] = "require_level",   ["text"] = "Required Level: ",  ["color"] = "777777" },
            { ["type"] = "job",             ["text"] = "Job: ",             ["color"] = "777777" },
            { ["type"] = "upper",           ["text"] = "Tier: ",            ["color"] = "777777" }
        }
    }
}

armor_default = {
    {
        ["item_id"] = {-1, -1},
        ["format"] = {
            { ["type"] = "flavour" },
            { ["type"] = "script" },
            { ["type"] = "trade",           ["color"] = "FF0000" },
            { ["type"] = "refinement",      ["text"] = "^FF0000Impossible to refine this item.^000000" },
            { ["type"] = "bind",            ["text"] = "^FF0000Equipment binds to character on equipped.^000000" },
            { ["type"] = "buyingstore",     ["text"] = "^FF00FFMay be sold in buying store.^000000" },
            { ["type"] = "type",            ["text"] = "Class: ",           ["color"] = "777777" },
            { ["type"] = "defense",         ["text"] = "Defense: ",         ["color"] = "777777" },
            { ["type"] = "location",        ["text"] = "Location: ",        ["color"] = "777777" },
            { ["type"] = "weight",          ["text"] = "Weight: ",          ["color"] = "777777" },
            { ["type"] = "require_level",   ["text"] = "Required Level: ",  ["color"] = "777777" },
            { ["type"] = "job",             ["text"] = "Job: ",             ["color"] = "777777" },
            { ["type"] = "upper",           ["text"] = "Tier: ",            ["color"] = "777777" }
        }
    }
}

pet_default = {
    {
        ["item_id"] = {-1, -1},
        ["format"] = {
            { ["type"] = "flavour" },
            { ["type"] = "script" },
            { ["type"] = "trade",           ["color"] = "FF0000" },
            { ["type"] = "buyingstore",     ["text"] = "^FF00FFMay be sold in buying store.^000000" },
            { ["type"] = "type",            ["text"] = "Class: ",           ["color"] = "777777" },
            { ["type"] = "weight",          ["text"] = "Weight: ",          ["color"] = "777777" }
        }
    }
}

card_default = {
    {
        ["item_id"] = {-1, -1},
        ["format"] = {
            { ["type"] = "flavour" },
            { ["type"] = "script" },
            { ["type"] = "trade",           ["color"] = "FF0000" },
            { ["type"] = "buyingstore",     ["text"] = "^FF00FFMay be sold in buying store.^000000" },
            { ["type"] = "type",            ["text"] = "Class: ",           ["color"] = "777777" },
            { ["type"] = "location",        ["text"] = "Compound On: ",     ["color"] = "777777" },
            { ["type"] = "weight",          ["text"] = "Weight: ",          ["color"] = "777777" }
        }
    }
}

ammo_default = {
    {
        ["item_id"] = {-1, -1},
        ["format"] = {
            { ["type"] = "flavour" },
            { ["type"] = "script" },
            { ["type"] = "trade",           ["color"] = "FF0000" },
            { ["type"] = "buyingstore",     ["text"] = "^FF00FFMay be sold in buying store.^000000" },
            { ["type"] = "view",            ["text"] = "Class: ",           ["color"] = "777777" },
            { ["type"] = "attack",          ["text"] = "Attack: ",          ["color"] = "777777" },
            { ["type"] = "weight",          ["text"] = "Weight: ",          ["color"] = "777777" }
        }
    }
}

--[[ default item format table ]]
default_item_format = {
    ["healing"]             = general_default,
    ["usable"]              = general_default,
    ["etc"]                 = general_default,
    ["weapon"]              = weapon_default,
    ["armor"]               = armor_default,
    ["card"]                = card_default,
    ["pet_egg"]             = pet_default,
    ["pet_equip"]           = pet_default,
    ["ammo"]                = ammo_default,
    ["delay_usable"]        = general_default,
    ["confirm_usable"]      = general_default,
    ["shadow_equip"]        = armor_default
}

compilation_table = {
    -- -- lua
    -- {
    --     ["output_format"]           = "lua",
    --     ["output_filename"]         = "ea_itemInfo.lua",
    --     ["server_type"]             = "eathena",
    --     ["resource_db_path"]        = "C:/Users/jim/Desktop/eadb.compiler/resources.db",
    --     ["server_db_path"]          = "C:/Users/jim/Desktop/eadb.compiler/eathena.db",
    --     ["flavour_text_db_path"]    = "C:/Users/jim/Desktop/eadb.compiler/res/resource/flavour_text.db",
    --     ["item_format"]             = default_item_format
    -- },
    -- {
    --     ["output_format"]           = "lua",
    --     ["output_filename"]         = "ra_itemInfo.lua",
    --     ["server_type"]             = "rathena",
    --     ["resource_db_path"]        = "C:/Users/jim/Desktop/eadb.compiler/resources.db",
    --     ["server_db_path"]          = "C:/Users/jim/Desktop/eadb.compiler/rathena.db",
    --     ["flavour_text_db_path"]    = "C:/Users/jim/Desktop/eadb.compiler/res/resource/flavour_text.db",
    --     ["item_type"]               = item_type,
    --     ["item_format"]             = default_item_format
    -- },
    -- {
    --     ["output_format"]           = "lua",
    --     ["output_filename"]         = "ra_pre_itemInfo.lua",
    --     ["server_type"]             = "rathena",
    --     ["resource_db_path"]        = "C:/Users/jim/Desktop/eadb.compiler/resources.db",
    --     ["server_db_path"]          = "C:/Users/jim/Desktop/eadb.compiler/rathena_pre.db",
    --     ["flavour_text_db_path"]    = "C:/Users/jim/Desktop/eadb.compiler/res/resource/flavour_text.db",
    --     ["item_type"]               = item_type,
    --     ["item_format"]             = default_item_format
    -- },
    -- {
    --     ["output_format"]           = "lua",
    --     ["output_filename"]         = "he_itemInfo.lua",
    --     ["server_type"]             = "hercules",
    --     ["resource_db_path"]        = "C:/Users/jim/Desktop/eadb.compiler/resources.db",
    --     ["server_db_path"]          = "C:/Users/jim/Desktop/eadb.compiler/hercules.db",
    --     ["flavour_text_db_path"]    = "C:/Users/jim/Desktop/eadb.compiler/res/resource/flavour_text.db",
    --     ["item_type"]               = item_type,
    --     ["item_format"]             = default_item_format
    -- },
    -- {
    --     ["output_format"]           = "lua",
    --     ["output_filename"]         = "he_pre_itemInfo.lua",
    --     ["server_type"]             = "hercules",
    --     ["resource_db_path"]        = "C:/Users/jim/Desktop/eadb.compiler/resources.db",
    --     ["server_db_path"]          = "C:/Users/jim/Desktop/eadb.compiler/hercules_pre.db",
    --     ["flavour_text_db_path"]    = "C:/Users/jim/Desktop/eadb.compiler/res/resource/flavour_text.db",
    --     ["item_type"]               = item_type,
    --     ["item_format"]             = default_item_format
    -- },
    -- txt
    {
        ["output_format"]           = "txt",
        ["output_filename"]         = "ea_idnum2itemdesctable.txt",
        ["server_type"]             = "eathena",
        ["resource_db_path"]        = "C:/Users/jim/Desktop/eadb.compiler/resources.db",
        ["server_db_path"]          = "C:/Users/jim/Desktop/eadb.compiler/eathena.db",
        ["flavour_text_db_path"]    = "C:/Users/jim/Desktop/eadb.compiler/res/resource/flavour_text.db",
        ["item_format"]             = default_item_format
    },
    {
        ["output_format"]           = "txt",
        ["output_filename"]         = "ra_idnum2itemdesctable.txt",
        ["server_type"]             = "rathena",
        ["resource_db_path"]        = "C:/Users/jim/Desktop/eadb.compiler/resources.db",
        ["server_db_path"]          = "C:/Users/jim/Desktop/eadb.compiler/rathena.db",
        ["flavour_text_db_path"]    = "C:/Users/jim/Desktop/eadb.compiler/res/resource/flavour_text.db",
        ["item_type"]               = item_type,
        ["item_format"]             = default_item_format
    },
    {
        ["output_format"]           = "txt",
        ["output_filename"]         = "ra_pre_idnum2itemdesctable.txt",
        ["server_type"]             = "rathena",
        ["resource_db_path"]        = "C:/Users/jim/Desktop/eadb.compiler/resources.db",
        ["server_db_path"]          = "C:/Users/jim/Desktop/eadb.compiler/rathena_pre.db",
        ["flavour_text_db_path"]    = "C:/Users/jim/Desktop/eadb.compiler/res/resource/flavour_text.db",
        ["item_type"]               = item_type,
        ["item_format"]             = default_item_format
    },
    {
        ["output_format"]           = "txt",
        ["output_filename"]         = "he_idnum2itemdesctable.txt",
        ["server_type"]             = "hercules",
        ["resource_db_path"]        = "C:/Users/jim/Desktop/eadb.compiler/resources.db",
        ["server_db_path"]          = "C:/Users/jim/Desktop/eadb.compiler/hercules.db",
        ["flavour_text_db_path"]    = "C:/Users/jim/Desktop/eadb.compiler/res/resource/flavour_text.db",
        ["item_type"]               = item_type,
        ["item_format"]             = default_item_format
    },
    {
        ["output_format"]           = "txt",
        ["output_filename"]         = "he_pre_idnum2itemdesctable.txt",
        ["server_type"]             = "hercules",
        ["resource_db_path"]        = "C:/Users/jim/Desktop/eadb.compiler/resources.db",
        ["server_db_path"]          = "C:/Users/jim/Desktop/eadb.compiler/hercules_pre.db",
        ["flavour_text_db_path"]    = "C:/Users/jim/Desktop/eadb.compiler/res/resource/flavour_text.db",
        ["item_type"]               = item_type,
        ["item_format"]             = default_item_format
    }
}

--[[ item type and item field table matches the constants in format.h ]]
item_type = {
    ["healing"]         = 0,
    ["usable"]          = 2,
    ["etc"]             = 3,
    ["weapon"]          = 4,
    ["armor"]           = 5,
    ["card"]            = 6,
    ["pet_egg"]         = 7,
    ["pet_equip"]       = 8,
    ["ammo"]            = 10,
    ["delay_usable"]    = 11,
    ["shadow_equip"]    = 12,
    ["confirm_usable"]  = 18
}

item_field = {
    ["flavour"]         = 0,
    ["type"]            = 1,
    ["buy"]             = 2,
    ["sell"]            = 3,
    ["weight"]          = 4,
    ["attack"]          = 5,
    ["defense"]         = 6,
    ["range"]           = 7,
    ["job"]             = 8,
    ["gender"]          = 9,
    ["location"]        = 10,
    ["weapon_level"]    = 11,
    ["require_level"]   = 12,
    ["refinement"]      = 13,
    ["script"]          = 14,
    ["view"]            = 15,
    ["upper"]           = 16,
    ["magical_attack"]  = 17,
    ["bind"]            = 18,
    ["buyingstore"]     = 19,
    ["delay"]           = 20,
    ["trade"]           = 21,
    ["stack"]           = 22
}

txt_header = [[]];
txt_footer = [[]];
lua_header = [[tbl = {]];
lua_footer = [[}
main = function()
    for ItemID, DESC in pairs(tbl) do
        result, msg = AddItem(ItemID, DESC.unidentifiedDisplayName, DESC.unidentifiedResourceName, DESC.identifiedDisplayName, DESC.identifiedResourceName, DESC.slotCount, DESC.ClassNum)
        if not result == true then
            return false, msg
        end
        for k, v in pairs(DESC.unidentifiedDescriptionName) do
            result, msg = AddItemUnidentifiedDesc(ItemID, v)
            if not result == true then
                return false, msg
            end
        end
        for k, v in pairs(DESC.identifiedDescriptionName) do
            result, msg = AddItemIdentifiedDesc(ItemID, v)
            if not result == true then
                return false, msg
            end
        end
        k = DESC.unidentifiedResourceName
        v = DESC.identifiedDisplayName
    end
    return true, "good"
end]];